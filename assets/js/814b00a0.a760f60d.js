"use strict";(self.webpackChunkcybersec_notes=self.webpackChunkcybersec_notes||[]).push([[1023],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return u}});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),h=c(a),u=r,g=h["".concat(l,".").concat(u)]||h[u]||d[u]||i;return a?n.createElement(g,s(s({ref:t},p),{},{components:a})):n.createElement(g,s({ref:t},p))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,s=new Array(i);s[0]=h;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var c=2;c<i;c++)s[c]=a[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},12427:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return o},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return h}});var n=a(87462),r=a(63366),i=(a(67294),a(3905)),s=["components"],o={},l=void 0,c={unversionedId:"portswigger/XSS/XSS-Into-Javascript",id:"portswigger/XSS/XSS-Into-Javascript",title:"XSS-Into-Javascript",description:"XSS into JavaScript",source:"@site/docs/portswigger/XSS/XSS-Into-Javascript.md",sourceDirName:"portswigger/XSS",slug:"/portswigger/XSS/XSS-Into-Javascript",permalink:"/Cybernotes/docs/portswigger/XSS/XSS-Into-Javascript",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"XSS-In-HTML-Tag-Attributes",permalink:"/Cybernotes/docs/portswigger/XSS/XSS-In-HTML-Tag-Attributes"},next:{title:"XSS-without-events",permalink:"/Cybernotes/docs/portswigger/XSS/XSS-without-events"}},p=[{value:"XSS into JavaScript",id:"xss-into-javascript",children:[{value:"Terminating the existing script",id:"terminating-the-existing-script",children:[],level:3}],level:2},{value:"Lab: Reflected XSS into a JavaScript string with single quote and backslash escaped",id:"lab-reflected-xss-into-a-javascript-string-with-single-quote-and-backslash-escaped",children:[],level:2},{value:"Breaking out of a JavaScript string",id:"breaking-out-of-a-javascript-string",children:[],level:2},{value:"Lab: Reflected XSS into a JavaScript string with angle brackets HTML encoded",id:"lab-reflected-xss-into-a-javascript-string-with-angle-brackets-html-encoded",children:[],level:2},{value:"Bypassing backslash",id:"bypassing-backslash",children:[],level:2},{value:"Lab: Reflected XSS into a JavaScript string with angle brackets and double quotes HTML-encoded and single quotes escaped",id:"lab-reflected-xss-into-a-javascript-string-with-angle-brackets-and-double-quotes-html-encoded-and-single-quotes-escaped",children:[],level:2},{value:"Lab: Reflected XSS in a JavaScript URL with some characters blocked",id:"lab-reflected-xss-in-a-javascript-url-with-some-characters-blocked",children:[],level:2}],d={toc:p};function h(e){var t=e.components,o=(0,r.Z)(e,s);return(0,i.kt)("wrapper",(0,n.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"xss-into-javascript"},"XSS into JavaScript"),(0,i.kt)("p",null,"When the XSS context is some existing JavaScript within the response, a wide variety of situations can arise, with different techniques necessary to perform a successful exploit."),(0,i.kt)("h3",{id:"terminating-the-existing-script"},"Terminating the existing script"),(0,i.kt)("p",null,"In the simplest case, it is possible to simply close the script tag that is enclosing the existing JavaScript, and introduce some new HTML tags that will trigger execution of JavaScript. For example, if the XSS context is as follows:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<script> ... var input = 'controllable data here'; ... <\/script>")),(0,i.kt)("p",null,"then you can use the following payload to break out of the existing JavaScript and execute your own:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<\/script><img src=1 onerror=alert(document.domain)>")),(0,i.kt)("p",null,"The reason this works is that the browser first performs HTML parsing to identify the page elements including blocks of script, and only later performs JavaScript parsing to understand and execute the embedded scripts. The above payload leaves the original script broken, with an unterminated string literal. But that doesn't prevent the subsequent script being parsed and executed in the normal way."),(0,i.kt)("h2",{id:"lab-reflected-xss-into-a-javascript-string-with-single-quote-and-backslash-escaped"},"Lab: Reflected XSS into a JavaScript string with single quote and backslash escaped"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"This lab contains a ",(0,i.kt)("a",{parentName:"p",href:"https://portswigger.net/web-security/cross-site-scripting/reflected"},"reflected cross-site scripting")," vulnerability in the search query tracking functionality. The reflection occurs inside a JavaScript string with single quotes and backslashes escaped.\nTo solve this lab, perform a cross-site scripting attack that breaks out of the JavaScript string and calls the ",(0,i.kt)("inlineCode",{parentName:"p"},"alert")," function.")),(0,i.kt)("p",null,"--\x3e First of all i searched for ",(0,i.kt)("inlineCode",{parentName:"p"},"test")," and intercepted request and response. I found that our searchItem was getting stored in variable and then it was encoding it so i tried this payload to break the script tag and enter our own xss payload which will trigger alert."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"<\/script><img+src%3dx+onerror%3dalert(document.domain)>\n")),(0,i.kt)("p",null,"And i solved the lab!"),(0,i.kt)("p",null,(0,i.kt)("img",{src:a(79655).Z,width:"1609",height:"805"})),(0,i.kt)("h2",{id:"breaking-out-of-a-javascript-string"},"Breaking out of a JavaScript string"),(0,i.kt)("p",null,"In cases where the XSS context is inside a quoted string literal, it is often possible to break out of the string and execute JavaScript directly. It is essential to repair the script following the XSS context, because any syntax errors there will prevent the whole script from executing."),(0,i.kt)("p",null,"Some useful ways of breaking out of a string literal are:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"'-alert(document.domain)-'\n';alert(document.domain)//\n")),(0,i.kt)("h2",{id:"lab-reflected-xss-into-a-javascript-string-with-angle-brackets-html-encoded"},"Lab: Reflected XSS into a JavaScript string with angle brackets HTML encoded"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"This lab contains a ",(0,i.kt)("a",{parentName:"p",href:"https://portswigger.net/web-security/cross-site-scripting/reflected"},"reflected cross-site scripting")," vulnerability in the search query tracking functionality where angle brackets are encoded. The reflection occurs inside a JavaScript string. To solve this lab, perform a cross-site scripting attack that breaks out of the JavaScript string and calls the ",(0,i.kt)("inlineCode",{parentName:"p"},"alert")," function.")),(0,i.kt)("p",null,"--\x3e So first i searched for ",(0,i.kt)("inlineCode",{parentName:"p"},"hacker")," and i got this part of response between ",(0,i.kt)("inlineCode",{parentName:"p"},"script")," tags."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"<script>\nvar searchTerms = 'Hacker';\ndocument.write('<img src=\"/resources/images/tracker.gif?searchTerms='+encodeURIComponent(searchTerms)+'\">');\n<\/script>\n")),(0,i.kt)("p",null,"So i used this payload to break the javascript :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"';alert(document.domain)//\n")),(0,i.kt)("p",null,"And it triggered the alert and we solved the lab!"),(0,i.kt)("p",null,(0,i.kt)("img",{src:a(71630).Z,width:"1825",height:"555"})),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"bypassing-backslash"},"Bypassing backslash"),(0,i.kt)("p",null,"Some applications attempt to prevent input from breaking out of the JavaScript string by escaping any single quote characters with a backslash. A backslash before a character tells the JavaScript parser that the character should be interpreted literally, and not as a special character such as a string terminator. In this situation, applications often make the mistake of failing to escape the backslash character itself. This means that an attacker can use their own backslash character to neutralize the backslash that is added by the application."),(0,i.kt)("p",null,"For example, suppose that the input:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"';alert(document.domain)//")),(0,i.kt)("p",null,"gets converted to:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\\';alert(document.domain)//")),(0,i.kt)("p",null,"You can now use the alternative payload:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\\';alert(document.domain)//")),(0,i.kt)("p",null,"which gets converted to:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\\\\';alert(document.domain)//")),(0,i.kt)("p",null,"Here, the first backslash means that the second backslash is interpreted literally, and not as a special character. This means that the quote is now interpreted as a string terminator, and so the attack succeeds."),(0,i.kt)("h2",{id:"lab-reflected-xss-into-a-javascript-string-with-angle-brackets-and-double-quotes-html-encoded-and-single-quotes-escaped"},"Lab: Reflected XSS into a JavaScript string with angle brackets and double quotes HTML-encoded and single quotes escaped"),(0,i.kt)("p",null,"--\x3e First i tried the previous payload which was this :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"';alert(document.domain)//\n")),(0,i.kt)("p",null,"But the website is inserting backslash ",(0,i.kt)("inlineCode",{parentName:"p"},"\\")," before any quote:"),(0,i.kt)("p",null,(0,i.kt)("img",{src:a(11599).Z,width:"1799",height:"703"})),(0,i.kt)("p",null,"So then i tried to insert the payload which contains backslash by default and the backslash from the server will break it and we will be able to trigger alert!"),(0,i.kt)("p",null,"So payload looks like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\\';alert(document.domain)//\n")),(0,i.kt)("p",null,"And as expected, website converted our backslash in ",(0,i.kt)("inlineCode",{parentName:"p"},"\\\\")," and our alert function went to next line and got executed!"),(0,i.kt)("p",null,(0,i.kt)("img",{src:a(93727).Z,width:"1725",height:"713"})),(0,i.kt)("p",null,"And we solved the lab!"),(0,i.kt)("hr",null),(0,i.kt)("p",null,"Some websites make XSS more difficult by restricting which characters you are allowed to use. This can be on the website level or by deploying a WAF that prevents your requests from ever reaching the website. In these situations, you need to experiment with other ways of calling functions which bypass these security measures. One way of doing this is to use the ",(0,i.kt)("inlineCode",{parentName:"p"},"throw")," statement with an exception handler. This enables you to pass arguments to a function without using parentheses. The following code assigns the ",(0,i.kt)("inlineCode",{parentName:"p"},"alert()")," function to the global exception handler and the ",(0,i.kt)("inlineCode",{parentName:"p"},"throw")," statement passes the ",(0,i.kt)("inlineCode",{parentName:"p"},"1")," to the exception handler (in this case ",(0,i.kt)("inlineCode",{parentName:"p"},"alert"),"). The end result is that the ",(0,i.kt)("inlineCode",{parentName:"p"},"alert()")," function is called with ",(0,i.kt)("inlineCode",{parentName:"p"},"1")," as an argument."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"onerror=alert;throw 1")),(0,i.kt)("p",null,"The next lab demonstrates a website that filters certain characters. You'll have to use similar techniques to those described above in order to solve it."),(0,i.kt)("h2",{id:"lab-reflected-xss-in-a-javascript-url-with-some-characters-blocked"},"Lab: Reflected XSS in a JavaScript URL with some characters blocked"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"This lab reflects your input in a JavaScript URL, but all is not as it seems. This initially seems like a trivial challenge; however, the application is blocking some characters in an attempt to prevent ",(0,i.kt)("a",{parentName:"p",href:"https://portswigger.net/web-security/cross-site-scripting"},"XSS")," attacks.\nTo solve the lab, perform a ",(0,i.kt)("a",{parentName:"p",href:"https://portswigger.net/web-security/cross-site-scripting"},"cross-site scripting")," attack that calls the ",(0,i.kt)("inlineCode",{parentName:"p"},"alert")," function with the string ",(0,i.kt)("inlineCode",{parentName:"p"},"1337")," contained somewhere in the ",(0,i.kt)("inlineCode",{parentName:"p"},"alert")," message.")),(0,i.kt)("p",null,"--\x3e i started by entering differnt payloads in post comment section because there were no search functionality in this website. I tried to get xss in ",(0,i.kt)("inlineCode",{parentName:"p"},"website")," field as some previous labs but it didn't worked :("),(0,i.kt)("p",null,"So after that i found that we have to inject payload in ",(0,i.kt)("inlineCode",{parentName:"p"},"postId")," parameter. So i found this payload:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"postId=1&%27},x=x=%3E{throw/**/onerror=alert,1337},toString=x,window%2b%27%27,{x:%27\n")),(0,i.kt)("p",null,"After decode it will be like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"'},x=x=>{throw/**/onerror=alert,1337},toString=x,window+'',{x:'\n")),(0,i.kt)("p",null,"In This payload, we are using exception handling and to make it work, we are using arrow functions here which are denoted with ",(0,i.kt)("inlineCode",{parentName:"p"},"x = x=> {}")," where x have the return value of function. So to display it we are converting it in string using ",(0,i.kt)("inlineCode",{parentName:"p"},"toString")," method and we are overriding the toString method for the object which we will create later in payload and passing it to ",(0,i.kt)("inlineCode",{parentName:"p"},"x")," and to show it on window we are using ",(0,i.kt)("inlineCode",{parentName:"p"},"window+''")," and we are passing the object which we want to convert which is ",(0,i.kt)("inlineCode",{parentName:"p"},"{x:'")),(0,i.kt)("p",null,"Reference : ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/toString"},"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/toString")),(0,i.kt)("p",null,"And after entering the above payload we solved the lab!"))}h.isMDXComponent=!0},79655:function(e,t,a){t.Z=a.p+"assets/images/Pastedimage20220313080132-939c523dd57cf5a6a9b05f8fc3d40724.png"},71630:function(e,t,a){t.Z=a.p+"assets/images/Pastedimage20220313124659-526e8efcf7dc12b5342a7494bce15aa7.png"},11599:function(e,t,a){t.Z=a.p+"assets/images/Pastedimage20220313130652-d8661767e12ced168455364f0558795e.png"},93727:function(e,t,a){t.Z=a.p+"assets/images/Pastedimage20220313131006-c97e4d8c038c403dd446718b749e2b8a.png"}}]);