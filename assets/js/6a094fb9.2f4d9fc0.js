"use strict";(self.webpackChunkcybersec_notes=self.webpackChunkcybersec_notes||[]).push([[3483],{3905:function(e,t,r){r.d(t,{Zo:function(){return p},kt:function(){return f}});var n=r(7294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var s=n.createContext({}),c=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(r),f=i,h=d["".concat(s,".").concat(f)]||d[f]||u[f]||o;return r?n.createElement(h,a(a({ref:t},p),{},{components:r})):n.createElement(h,a({ref:t},p))}));function f(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=r.length,a=new Array(o);a[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,a[1]=l;for(var c=2;c<o;c++)a[c]=r[c];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},2822:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return p},default:function(){return d}});var n=r(7462),i=r(3366),o=(r(7294),r(3905)),a=["components"],l={},s=void 0,c={unversionedId:"portswigger/File-upload/Lab-3 File-upload-with-directory-traversal",id:"portswigger/File-upload/Lab-3 File-upload-with-directory-traversal",title:"Lab-3 File-upload-with-directory-traversal",description:"Preventing file execution in user-accessible directories",source:"@site/docs/portswigger/File-upload/Lab-3 File-upload-with-directory-traversal.md",sourceDirName:"portswigger/File-upload",slug:"/portswigger/File-upload/Lab-3 File-upload-with-directory-traversal",permalink:"/Cybernotes/docs/portswigger/File-upload/Lab-3 File-upload-with-directory-traversal",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Lab-2 Flawd-file-type-validation",permalink:"/Cybernotes/docs/portswigger/File-upload/Lab-2 Flawd-file-type-validation"},next:{title:"Lab-4 Overriding-the-server-configuration",permalink:"/Cybernotes/docs/portswigger/File-upload/Lab-4 Overriding-the-server-configuration"}},p=[{value:"Preventing file execution in user-accessible directories",id:"preventing-file-execution-in-user-accessible-directories",children:[],level:2},{value:"Challenge",id:"challenge",children:[],level:2}],u={toc:p};function d(e){var t=e.components,l=(0,i.Z)(e,a);return(0,o.kt)("wrapper",(0,n.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"preventing-file-execution-in-user-accessible-directories"},"Preventing file execution in user-accessible directories"),(0,o.kt)("p",null,"While it's clearly better to prevent dangerous file types being uploaded in the first place, the second line of defense is to stop the server from executing any scripts that do slip through the net."),(0,o.kt)("p",null,"As a precaution, servers generally only run scripts whose MIME type they have been explicitly configured to execute. Otherwise, they may just return some kind of error message or, in some cases, serve the contents of the file as plain text instead:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"GET /static/exploit.php?command=id HTTP/1.1\nHost: normal-website.com\n\nHTTP/1.1 200 OK\nContent-Type: text/plain\nContent-Length: 39\n\n<?php echo system($_GET['command']); ?>\n")),(0,o.kt)("p",null,"This behavior is potentially interesting in its own right, as it may provide a way to leak source code, but it nullifies any attempt to create a web shell."),(0,o.kt)("p",null,"This kind of configuration often differs between directories. A directory to which user-supplied files are uploaded will likely have much stricter controls than other locations on the filesystem that are assumed to be out of reach for end users. If you can find a way to upload a script to a different directory that's not supposed to contain user-supplied files, the server may execute your script after all."),(0,o.kt)("h2",{id:"challenge"},"Challenge"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"In this challenge we don't have upload permission on php files in current directory so we have to upload that to another directory and find the ",(0,o.kt)("inlineCode",{parentName:"p"},"/home/carlos/secret"))),(0,o.kt)("p",null,"--\x3e So i used the same payload as previous challenges:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"<?php echo shell_exec('cat /home/carlos/secret'); ?>\n")),(0,o.kt)("p",null,"--\x3e After that i changed the filename to ",(0,o.kt)("inlineCode",{parentName:"p"},"..%2fwebshell.php")," which is equal to ",(0,o.kt)("inlineCode",{parentName:"p"},"../webshell.php")," and it will store the file in one previous directory of current location so let's try this !"),(0,o.kt)("p",null,"And file got uploaded!"),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(3452).Z,width:"1751",height:"795"})),(0,o.kt)("p",null,"--\x3e When we copy the image location we find the flag!"),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(3249).Z,width:"1183",height:"293"})))}d.isMDXComponent=!0},3249:function(e,t,r){t.Z=r.p+"assets/images/Pastedimage20220124132250-8bba34129d9606f26d508eb89f738b96.png"},3452:function(e,t,r){t.Z=r.p+"assets/images/Pastedimage20220124132312-f0c32ac92949dcbcea5badc23bc2a613.png"}}]);